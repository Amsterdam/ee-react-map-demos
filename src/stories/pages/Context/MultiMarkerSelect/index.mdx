import { Canvas, Meta, Source, Story } from '@storybook/blocks';
import * as MultiMarkerSelectStories from './index.stories';
import MapContext from '@/pages/MapContextExample/MultiMarkerSelect/MapContext?raw';
import MultiMarkerSelect from '@/pages/MapContextExample/MultiMarkerSelect/MultiMarkerSelect?raw';
import MapProvider from '@/pages/MapContextExample/MultiMarkerSelect/MapProvider?raw';
import Map from '@/pages/MapContextExample/MultiMarkerSelect/Map?raw';
import Alert from '@/pages/MapContextExample/MultiMarkerSelect/Alert?raw';
import data from '@/pages/MapContextExample/MultiMarkerSelect/data.json?raw';
import types from '@/pages/MapContextExample/MultiMarkerSelect/types?raw';
import styles from '@/pages/MapContextExample/styles.module.css?raw';

<Meta of={MultiMarkerSelectStories} />

# Context - Multiple Marker Select

## Description

Using Amsterdam taxi stands from the [Parkeervakken (Parking Spaces) API](https://api.data.amsterdam.nl/v1/parkeervakken/), you can select multiple Polygon layers.

The selected layer(s) state is accessible via state variable `selectedMarkers` and settable via the state method `setSelectedMarkers`.

When adding the layers to the map (lines 107-130), a `click` event listener is added to each Polygon layer; alongside a `mouseover` and `mouseout` event. In the `click` event listener callback, we add/remove the event-triggered layer from the context's state.

The context handles the following state and methods:

* `mapInstance` - *Referencing the active Leaflet map*
* `setMapInstance` - *For setting the active Leaflet map into state*
* `position` - *Referencing the current centre point of the Leaflet map object*
* `setPosition` - *For setting the current centre point of the Leaflet map object into state*
* `markerData` - *Data to output on the map, usually derived from a fetch request to an API*
* `setMarkerData` - *For setting the map data into state*
* `selectedMarkers` - *An array of IDs, which correspond to the Polygon layer data*
* `setSelectedMarkers` - *For setting the selected layers into state*

## CustomProperty/Map.tsx

```
const marker = featureLayer
  .getLayers()
  .find(
    (layer): layer is MapContextExampleLayer =>
      (layer as MapContextExampleLayer)?.feature?.properties?.id ===
      selectedMarker
  );
// Above replaces this in a TS friendly manner
// .find(layer => layer?.feature.properties?.id === selectedMarker);
```

## How to implement

To accomplish the
1. The React components
    * [MapContext.ts](#--mapcontextts)
    * [MapProvider.tsx](#--mapprovidertsx)
    * [MultiMarkerSelect.tsx](#--multimarkerselecttsx)
    * [Map.tsx](#--maptsx)
    * [Alert.tsx](#--alerttsx)
2. CSS styles
    * [styles.module.css](#--stylesmodulecss)
3. Type definitions
    * [types.ts](#--typests)
4. Data
    * [data.json](#--datajson) *(This static data should be replaced by a fetch call or other static data)*

## Usage

### React Components

#### - MapContext.ts

<Source code={MapContext} />

#### - MapProvider.tsx

<Source code={MapProvider} />

#### - MultiMarkerSelect.tsx

<Source code={MultiMarkerSelect} />

#### - Map.tsx

<Source code={Map} />

#### - Alert.tsx

<Source code={Alert} />

### Type definitions

#### - types.ts

<Source code={types} />

### CSS styles

#### - styles.module.css

<Source code={styles} />

#### - types.ts

<Source code={types} />

### Data

#### - data.json

*Code intentionally shortened*

<Source code={`${data.substring(0, 800)}...`} />
